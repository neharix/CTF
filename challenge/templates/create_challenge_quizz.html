<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>CTF Oýunlary - Kiberhowpsuzlyk ýaryşy</title>
        {% load static %}
        <link rel="stylesheet"
              href="{% static 'main/challenge.css' %}?{% now " U" %}">
        <link rel="shortcut icon"
              type="image/png"
              href="{% static 'main/logo-black.png' %}" />
        <link href="{% static 'main/bootstrap.min.css' %}" rel="stylesheet">
    </head>
    <body>
        {% include 'navbar.html' %}
        {% block content %}
            <div class="container text-center">
                <div class="h1">Sowalnama dörediň</div>
            </div>
            <form action=""
                  method="post"
                  autocomplete="off"
                  enctype="multipart/form-data">
                <!-- Quizz Section -->
                <div class="container quizz-container">
                    <div class="card col-sm-7 pt-0 rounded-4 mt-5 mx-auto" id="quizz-card1">
                        <div class="container text-end w-100">
                            <button type="button"
                                    onclick="delQuizz(event)"
                                    id="delQuizzBtn"
                                    class="btn-close-white btn-close me-0"
                                    aria-label="Close"></button>
                        </div>
                        {% csrf_token %}
                        <label for="name" class="text-capitalize ms-3">Ady</label>
                        <div class="form-control bg-transparent border-0">
                            <input type="text"
                                   class="form-control bg-transparent border-2 text-light fs-4"
                                   style="border-color: #696d97"
                                   name="name"
                                   id="name"
                                   required>
                        </div>
                        <label for="question" class="text-capitalize ms-3">Sorag</label>
                        <div class="form-control bg-transparent border-0">
                            <textarea class="form-control bg-transparent border-2 text-light fs-4"
                                      style="border-color: #696d97"
                                      name="question"
                                      id="question"
                                      required></textarea>
                        </div>
                        <label id="answer-label" for="answer" class="text-capitalize ms-3">Jogaby</label>
                        <div id="answer" class="form-control bg-transparent border-0">
                            <textarea class="form-control bg-transparent border-2 text-light fs-4"
                                      style="border-color: #696d97"
                                      name="answer"
                                      id="answer"></textarea>
                        </div>
                        <label for="point" class="text-capitalize ms-3">Bal</label>
                        <div class="form-control bg-transparent border-0">
                            <input type="text"
                                   class="form-control bg-transparent border-2 text-light fs-4"
                                   style="border-color: #696d97"
                                   name="point"
                                   id="point"
                                   required>
                        </div>
                        <div class="row ms-3">
                            <div class="form-check col-2" style="pointer-events: none;">
                                <input onclick="add_ctf_user(event)"
                                       class="form-check-input"
                                       id="pentest-check"
                                       style="pointer-events:all"
                                       type="checkbox">
                                <label for="pentest-check" class="ms-3">Pentest saýt</label>
                            </div>
                            <div class="form-check col-2" style="pointer-events: none;">
                                <input onclick="sql_injection(event)"
                                       class="form-check-input"
                                       id="sql-injection-check"
                                       name="sql-injection-field"
                                       style="pointer-events:all"
                                       type="checkbox">
                                <label for="sql-injection-check" class="ms-3">SQL injection</label>
                            </div>
                            <div class="form-check col-3" style="pointer-events: none;">
                                <input onclick="steganography(event)"
                                       class="form-check-input"
                                       id="steganography-check"
                                       name="steganography-field"
                                       style="pointer-events:all"
                                       type="checkbox">
                                <label for="steganography-check" class="ms-3">Steganografiýa</label>
                            </div>
                            <div class="form-check col-2" style="pointer-events: none;">
                                <input onclick="matreshka(event)"
                                       class="form-check-input"
                                       id="matreshka-check"
                                       name="mathreshka-field"
                                       style="pointer-events:all"
                                       type="checkbox">
                                <label for="steganography-check" class="ms-3">Matreşka</label>
                            </div>
                        </div>
                        <div style="width: 100%;" id="file-container"></div>
                        <div style="width: 100%;" id="hint-container"></div>
                        <div class="m-2 col-12">
                            <button onclick="addFile(event)"
                                    type="button"
                                    class="btn btn-sm btn-light mx-auto mb-2 me-3"
                                    style="background-color: #696d97!important">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="16"
                                     height="16"
                                     fill="currentColor"
                                     class="bi bi-plus"
                                     viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path>
                                </svg>
                                Faýl goşuň
                            </button>
                            <button onclick="addHint(event)"
                                    type="button"
                                    class="btn btn-sm btn-light mx-auto mb-2 me-3"
                                    style="background-color: #696d97!important">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                     width="16"
                                     height="16"
                                     fill="currentColor"
                                     class="bi bi-plus"
                                     viewBox="0 0 16 16">
                                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path>
                                </svg>
                                Maslahat goşuň
                            </button>
                            <input name="type-of-quizz"
                                   id="type-of-quizz"
                                   value="Default"
                                   type="text"
                                   style="display: none">
                        </div>
                    </div>
                </div>
                <div class="container text-center mt-5">
                    <div class="input-group d-inline-block ">
                        <button type="button"
                                class="btn btn-lg btn-light text-light"
                                onclick="location.href='{% url 'display_quizzes' challenge.id %}'"
                                style="background-color: #800202!important">Çykyş</button>
                        <button type="submit"
                                class="btn btn-lg btn-light text-light"
                                style="background-color: #696d97!important">Tassyklamak & Dowam etmek</button>
                    </div>
                </div>
                <div class="text-end col-12 my-3"></div>
                <input type="number"
                       style="display: none"
                       name="files_count"
                       id="files_count" />
            </form>
        {% endblock content %}
        {% include 'footer.html' %}
        <script>
        var num = 1;
        
        let hidden_files_count = document.querySelector("#files_count");
        var files_count = 0;
        hidden_files_count.value = files_count;
        
        let answer_label = document.querySelector("#answer-label");
        let answer_field = document.querySelector("#answer");

        let matreshka_check = document.querySelector("#matreshka-check");
        let pentest_checkbox = document.querySelector("#pentest-check");
        let sql_injection_check = document.querySelector("#sql-injection-check");
        let steganography_check = document.querySelector("#steganography-check");
    
        let type_of_quizz = document.querySelector("#type-of-quizz");

        function addQuizz() {
            num += 1;
            const container = document.querySelector('.quizz-container');
            const newcard = document.createElement('DIV');
            newcard.className = 'card col-sm-7 pt-0 rounded-4 mx-auto mt-5';
            newcard.id = 'quizz-card' + num;
            newcard.innerHTML = '<div class="container text-end w-100"> <button type="button" onclick="delQuizz(event)" id="delQuizzBtn" class="btn-close-white btn-close me-0" aria-label="Close"></button> </div> {% csrf_token %} {% for field in form %} {% if field.name == "question" or field.name == "answer" %} <label for="{{field.name}}" class="text-capitalize ms-3"> {{field.name}} </label> <div class="form-control bg-transparent border-0"> <textarea class="form-control bg-transparent border-2 text-light fs-4" style="border-color: #696d97;" name="{{field.name}}" id="{{ field.name }}" required></textarea> </div> {% elif field.name == "file_content" %} <div class="row ms-3"> <div class="form-check col-2" style="pointer-events: none;"> <input class="form-check-input" style="pointer-events:all;" type="checkbox" value="" id="flexCheckDefault" onclick="addfile(event)"> <label class="form-check-label" for="flexCheckDefault"> Add file </label> </div> <!-- <div class="ms-3 col-3" id="uploadElement"> <input type="file" name="file_content" id="id_file_content"> </div> --> </div> {% else %} <label for="{{field.name}}" class="text-capitalize ms-3"> {{field.name}} </label> <div class="form-control bg-transparent border-0"> <input type="text" class="form-control bg-transparent border-2 text-light fs-4" style="border-color: #696d97;" name="{{field.name}}" id="{{ field.name }}" required> </div> {% endif %} {% endfor %} <div style="width: 100%;" id="hint-container"> <!-- <div class="input-group form-control bg-transparent border-0 hint-element"> <input type="" class="d-none" id="quizz_id" name="quizz_id"> <span class="input-group-text bg-transparent border-2 text-light fs-4 my-3">Hint</span> <input type="text" placeholder="Hint" style="width: 350px;" aria-label="Hint" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint"> <input type="text" placeholder="Points" style="min-width: 70px;" aria-label="Point" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint_point"> <button onclick="delHint(event)" class="btn btn-outline-danger my-3 fs-4" type="button" id="hintDelBtn">Discard</button> </div> --> </div> <div class="text-end col-12"> <button onclick="addHint(event)" type="button" class="btn btn-sm btn-light mx-auto mb-2 me-3" style="background-color: #696d97!important;"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16"> <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"> </path> </svg> Add a hint </button> </div>';

            container.appendChild(newcard);
        }

        function delQuizz(event) {
            event.target.parentElement.parentElement.remove();
        }
        function sql_injection(event) {
            if (pentest_checkbox.checked == true){
                pentest_checkbox.checked = false;               
            }
            if (steganography_check.checked == true){
                steganography_check.checked = false;               
            }
            if (matreshka_check.checked == true){
                matreshka_check.checked = false;
            }
            if (event.target.checked == true) {
                let element = document.querySelector("#ctf_data");
                const container = event.target.parentElement.parentElement;
                answer_label.style = "display: none;";
                answer_field.style = "display: none;";
                if (element != null) {
                    container.removeChild(element);
                }
                type_of_quizz.value = "SQL Injection";
            }
            else
            {
                type_of_quizz.value = "Default";
                answer_label.style = "";
                answer_field.style = "";
            }
        }
        function add_ctf_user(event) {
            if (sql_injection_check.checked == true){
                sql_injection_check.checked = false;
            }
            if (steganography_check.checked == true){
                steganography_check.checked = false;
            }
            if (matreshka_check.checked == true){
                matreshka_check.checked = false;
            }
            if (event.target.checked == true) {
                const container = event.target.parentElement.parentElement;
                const newElement = document.createElement('DIV');
                newElement.className = 'form-control bg-transparent border-0';
                newElement.id = 'ctf_data';
                newElement.innerHTML = '<div class="px-4"><label style="color: white;" class="m-2 fs-5">Kitaphana ulanyjysy</label><input type="text" class="form-control bg-transparent border-2 text-light fs-4" name="ctf_username" required><br><label style="color:white;" class="m-2 fs-5">Açar sözi</label><input type="text" class="form-control bg-transparent border-2 text-light fs-4" name="ctf_password" required></div>';
                container.appendChild(newElement);
                answer_label.style = "display: none;";
                answer_field.style = "display: none;";
                type_of_quizz.value = "Pentest";
            }
            else {
                type_of_quizz.value = "Default";
                event.target.parentElement.parentElement.parentElement.querySelector('#ctf_data').remove();
                answer_label.style = "";
                answer_field.style = "";
            }
        }
        
        function steganography(event){
            if (sql_injection_check.checked == true){
                sql_injection_check.checked = false;
            }
            if (pentest_checkbox.checked == true){
                pentest_checkbox.checked = false;
            }
            if (matreshka_check.checked == true){
                matreshka_check.checked = false;
            }
            if (event.target.checked == true) {
                answer_label.style = "display: none;";
                answer_field.style = "display: none;";
                type_of_quizz.value = "Steganography";
                let element = document.querySelector("#ctf_data");
                const container = event.target.parentElement.parentElement;
                if (element != null) {
                    container.removeChild(element);
                }
            }
            else {
                type_of_quizz.value = "Default";
                answer_label.style = "";
                answer_field.style = "";
            }

        }
        function matreshka(event) {
            if (sql_injection_check.checked == true){
                sql_injection_check.checked = false;
            }
            if (pentest_checkbox.checked == true){
                pentest_checkbox.checked = false;
            }
            if (steganography_check.checked == true){
                steganography_check.checked = false;
            }
            if (event.target.checked == true) {
                answer_label.style = "display: none;";
                answer_field.style = "display: none;";
                type_of_quizz.value = "Matreshka";
                let element = document.querySelector("#ctf_data");
                const container = event.target.parentElement.parentElement;
                if (element != null) {
                    container.removeChild(element);
                }
            }
            else {
                type_of_quizz.value = "Default";
                answer_label.style = "";
                answer_field.style = "";
            }

        }
        


        function addFile(event) {
            const container = event.target.parentElement.parentElement.querySelector('#file-container');

            const newcard = document.createElement('DIV');
            
            files_count += 1;
            hidden_files_count.value = files_count;

            newcard.className = 'input-group p-2 form-control bg-transparent border-0 file-element';
            newcard.innerHTML = '<input type="" class="d-none" id="quizz_id" name="quizz_id"><span class="input-group-text bg-transparent border-2 text-light fs-4 my-3">Faýl</span> <input type="file" style="width: 350px;" aria-label="File" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="file' + files_count + '" required><button onclick="delFile(event)" class="btn btn-outline-danger my-3" type="button" id="fileDelBtn">Pozmak</button>'
            newcard.style = "align-items: center;";

            container.appendChild(newcard);
        }

        function addHint(event) {
            const container = event.target.parentElement.parentElement.querySelector('#hint-container');

            const newcard = document.createElement('DIV');
            newcard.className = 'input-group form-control bg-transparent border-0 hint-element';
            newcard.innerHTML = '<input type="" class="d-none" id="quizz_id" name="quizz_id"><span class="input-group-text bg-transparent border-2 text-light fs-4 my-3">Maslahat</span> <input type="text" placeholder="Maslahat" style="width: 350px;" aria-label="Hint" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint" required> <input type="text" placeholder="Ballar" style="min-width: 70px;" aria-label="Point" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint_point" required> <button onclick="delHint(event)" class="btn btn-outline-danger my-3 fs-4" type="button" id="hintDelBtn">Pozmak</button>'

            container.appendChild(newcard);
        }

        function delHint(event) {
            event.target.parentElement.remove();
        }
        function delFile(event) {
            files_count -= 1 ;
            hidden_files_count.value = files_count;
            event.target.parentElement.remove();
        }
        </script>
        <script src="{% static 'main/bootstrap.bundle.min.js' %}"></script>
    </body>
</html>
