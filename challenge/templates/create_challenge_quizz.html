{% extends "layout.html" %}
{% load static %}
{% block head %}
    <link rel="stylesheet"
          href="{% static 'main/challenge.css' %}?{% now " U" %}">
    <link rel="stylesheet" href="{% static 'main/style.css' %}">
    <style>
        label {
            color: white;
            font-size: 1.4rem;
        }
    </style>
{% endblock head %}
{% block body %}
    <div class="container text-center">
        <div class="h1 text-white">Sowalnama dörediň</div>
    </div>
    <form action=""
          method="post"
          autocomplete="off"
          enctype="multipart/form-data">
        <!-- Quizz Section -->
        <div class="container quizz-container">
            <div class="card col-sm-7 pt-0 rounded-4 mt-5 mx-auto" id="quizz-card1">
                <div class="container text-end w-100">
                    <button type="button"
                            onclick="delQuizz(event)"
                            id="delQuizzBtn"
                            class="btn-close-white btn-close me-0"
                            aria-label="Close"></button>
                </div>
                {% csrf_token %}
                <label for="name" class="text-capitalize ms-3">Ady</label>
                <div class="form-control bg-transparent border-0">
                    <input type="text"
                           class="form-control bg-transparent border-2 text-light fs-4"
                           style="border-color: #696d97"
                           name="name"
                           id="name"
                           required>
                </div>
                <label for="question" class="text-capitalize ms-3">Sorag</label>
                <div class="form-control bg-transparent border-0">
                    <textarea class="form-control bg-transparent border-2 text-light fs-4"
                              style="border-color: #696d97"
                              name="question"
                              id="question"
                              required></textarea>
                </div>
                <label id="answer-label" for="answer" class="text-capitalize ms-3">Jogaby</label>
                <div id="answer" class="form-control bg-transparent border-0">
                    <textarea class="form-control bg-transparent border-2 text-light fs-4"
                              style="border-color: #696d97"
                              name="answer"
                              id="answer"></textarea>
                </div>
                <label for="point" class="text-capitalize ms-3">Bal</label>
                <div class="form-control bg-transparent border-0">
                    <input type="text"
                           class="form-control bg-transparent border-2 text-light fs-4"
                           style="border-color: #696d97"
                           name="point"
                           id="point"
                           required>
                </div>
                <label for="type-of-quizz" class="text-capitalize ms-3">Görnüşi</label>
                <div class="form-control bg-transparent border-0">
                    <input type="text"
                           class="form-control bg-transparent border-2 text-light fs-4"
                           style="border-color: #696d97"
                           name="type-of-quizz"
                           id="type-of-quizz"
                           required>
                </div>
                <div style="width: 100%;" id="file-container"></div>
                <div style="width: 100%;" id="hint-container"></div>
                <div class="m-2 col-12">
                    <button onclick="addFile(event)"
                            type="button"
                            class="btn btn-sm btn-light mx-auto mb-2 me-3 unborder btn-text-size"
                            style="background-color: #696d97!important">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="16"
                             height="16"
                             fill="currentColor"
                             class="bi bi-plus"
                             viewBox="0 0 16 16">
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path>
                        </svg>
                        Faýl goşuň
                    </button>
                    <button onclick="addHint(event)"
                            type="button"
                            class="btn btn-sm btn-light mx-auto mb-2 me-3 btn-text-size unborder"
                            style="background-color: #696d97!important">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             width="16"
                             height="16"
                             fill="currentColor"
                             class="bi bi-plus"
                             viewBox="0 0 16 16">
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"></path>
                        </svg>
                        Maslahat goşuň
                    </button>
                </div>
            </div>
        </div>
        <div class="container text-center mt-5">
            <div class="input-group d-inline-block ">
                <button type="button"
                        class="btn btn-lg btn-light text-light unborder btn-text-size"
                        onclick="location.href='{% url 'display_quizzes' challenge.id %}'"
                        style="background-color: #800202!important">Çykyş</button>
                <button type="submit"
                        class="btn btn-lg btn-light text-light unborder btn-text-size"
                        style="background-color: #696d97!important">Tassyklamak & Dowam etmek</button>
            </div>
        </div>
        <div class="text-end col-12 my-3"></div>
        <input type="number"
               style="display: none"
               name="files_count"
               id="files_count" />
    </form>
    <script>
        var num = 1;
        
        let hidden_files_count = document.querySelector("#files_count");
        var files_count = 0;
        hidden_files_count.value = files_count;
        
        let answer_label = document.querySelector("#answer-label");
        let answer_field = document.querySelector("#answer");

        let matreshka_check = document.querySelector("#matreshka-check");
        let pentest_checkbox = document.querySelector("#pentest-check");
        let sql_injection_check = document.querySelector("#sql-injection-check");
        let steganography_check = document.querySelector("#steganography-check");
    
        let type_of_quizz = document.querySelector("#type-of-quizz");

        function addQuizz() {
            num += 1;
            const container = document.querySelector('.quizz-container');
            const newcard = document.createElement('DIV');
            newcard.className = 'card col-sm-7 pt-0 rounded-4 mx-auto mt-5';
            newcard.id = 'quizz-card' + num;
            newcard.innerHTML = '<div class="container text-end w-100"> <button type="button" onclick="delQuizz(event)" id="delQuizzBtn" class="btn-close-white btn-close me-0" aria-label="Close"></button> </div> {% csrf_token %} {% for field in form %} {% if field.name == "question" or field.name == "answer" %} <label for="{{field.name}}" class="text-capitalize ms-3"> {{field.name}} </label> <div class="form-control bg-transparent border-0"> <textarea class="form-control bg-transparent border-2 text-light fs-4" style="border-color: #696d97;" name="{{field.name}}" id="{{ field.name }}" required></textarea> </div> {% elif field.name == "file_content" %} <div class="row ms-3"> <div class="form-check col-2" style="pointer-events: none;"> <input class="form-check-input" style="pointer-events:all;" type="checkbox" value="" id="flexCheckDefault" onclick="addfile(event)"> <label class="form-check-label" for="flexCheckDefault"> Add file </label> </div> <!-- <div class="ms-3 col-3" id="uploadElement"> <input type="file" name="file_content" id="id_file_content"> </div> --> </div> {% else %} <label for="{{field.name}}" class="text-capitalize ms-3"> {{field.name}} </label> <div class="form-control bg-transparent border-0"> <input type="text" class="form-control bg-transparent border-2 text-light fs-4" style="border-color: #696d97;" name="{{field.name}}" id="{{ field.name }}" required> </div> {% endif %} {% endfor %} <div style="width: 100%;" id="hint-container"> <!-- <div class="input-group form-control bg-transparent border-0 hint-element"> <input type="" class="d-none" id="quizz_id" name="quizz_id"> <span class="input-group-text bg-transparent border-2 text-light fs-4 my-3">Hint</span> <input type="text" placeholder="Hint" style="width: 350px;" aria-label="Hint" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint"> <input type="text" placeholder="Points" style="min-width: 70px;" aria-label="Point" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint_point"> <button onclick="delHint(event)" class="btn btn-outline-danger my-3 fs-4" type="button" id="hintDelBtn">Discard</button> </div> --> </div> <div class="text-end col-12"> <button onclick="addHint(event)" type="button" class="btn btn-sm btn-light mx-auto mb-2 me-3" style="background-color: #696d97!important;"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus" viewBox="0 0 16 16"> <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"> </path> </svg> Add a hint </button> </div>';

            container.appendChild(newcard);
        }

        function delQuizz(event) {
            event.target.parentElement.parentElement.remove();
        }


        function addFile(event) {
            const container = event.target.parentElement.parentElement.querySelector('#file-container');

            const newcard = document.createElement('DIV');
            
            files_count += 1;
            hidden_files_count.value = files_count;

            newcard.className = 'input-group p-2 form-control bg-transparent border-0 file-element';
            newcard.innerHTML = '<input type="" class="d-none" id="quizz_id" name="quizz_id"><span class="input-group-text bg-transparent border-2 text-light fs-4 my-3">Faýl</span> <input type="file" style="width: 350px;" aria-label="File" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="file' + files_count + '" required><button onclick="delFile(event)" class="btn btn-outline-danger my-3 btn-text-size-unchange" type="button" id="fileDelBtn">Pozmak</button>'
            newcard.style = "align-items: center;";

            container.appendChild(newcard);
        }

        function addHint(event) {
            const container = event.target.parentElement.parentElement.querySelector('#hint-container');

            const newcard = document.createElement('DIV');
            newcard.className = 'input-group form-control bg-transparent border-0 hint-element';
            newcard.innerHTML = '<input type="" class="d-none" id="quizz_id" name="quizz_id"><span class="input-group-text bg-transparent border-2 text-light fs-4 my-3">Maslahat</span> <input type="text" style="width: 350px;" aria-label="Hint" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint" required> <input type="text" style="min-width: 70px;" aria-label="Point" class="form-control bg-transparent border-2 text-light fs-4 my-3" name="hint_point" required> <button onclick="delHint(event)" class="btn btn-outline-danger btn-text-size-unchange my-3 fs-4" type="button" id="hintDelBtn">Pozmak</button>'

            container.appendChild(newcard);
        }

        function delHint(event) {
            event.target.parentElement.remove();
        }
        function delFile(event) {
            files_count -= 1 ;
            hidden_files_count.value = files_count;
            event.target.parentElement.remove();
        }
    </script>
    <script src="{% static 'main/bootstrap.bundle.min.js' %}"></script>
{% endblock body %}
